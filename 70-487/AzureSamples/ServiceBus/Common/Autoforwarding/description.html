<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/9bf1b74c-1640-46af-84d3-e440c8f95162Combined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Service Bus Autoforwarding</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Service Bus Autoforwarding</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Microsoft Azure, Service Bus
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Service Bus, Windows Azure Service Bus
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop, Web, Cloud
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">4/11/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/Service-Bus-Autoforwarding-b9df470b">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<div>This sample demonstrates how to automatically forward messages from a queue, subscription, or deadletter queue into another queue or topic. It also demonstrates how to send a message into a queue or topic via a transfer queue.</div>
<h1>Building the Sample</h1>
<ul>
<li>Install Windows Azure SDK 2.3 or later. </li><li>Create a Service Bus namespace. </li><li>In files Program.cs, replace strings serviceNamespace, sasKeyName and sasKey with the information of your namespace.
</li><li>Build the sample. Open the solution in Visual Studio 2010 or later and press F6.
</li><li>Press F5 to run the application. </li></ul>
<div>The sample generates 3 messages: M1, M2 and M3. M1 is sent to a source topic with one subscription, from which it is fowarded to a destination queue. M2 is sent to the destination queue via a transfer queue. M3 is sent to a source topic with two subscriptions.
 One subscription forwards M3 to the destination queue. The second subscription deadletters M3. Service Bus forwards this copy of M3 to the destination queue.</div>
<h1>Description</h1>
<div>The auto-forwarding feature enables you to chain a subscription or queue to another queue or topic that is part of the same service namespace. When auto-forwarding is enabled, Service Bus automatically removes messages that are placed in the first queue
 or subscription (source) and puts them in the second queue or topic (destination). Note that it is still possible to send a message to the destination entity directly. Also note that it is not possible to chain a subqueue, such as a deadletter queue, to another
 queue or topic.</div>
<div>To forward messages from a source queue or subscription to a destination queue or topic, set the QueueDescription.ForwardTo property to the name of destination queue or topic. Note that the destination queue/topic must aleady exist at the time you create
 the source queue/subscription. Service Bus requires the sender to attach a token that indicates that the sender has send permissions on the source topic. The sender does not need any permissions on the destination queue.
<div>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">QueueDescription sourceQueueDescription = new QueueDescription(SourceQueueName);
sourceQueueDescription.ForwardTo = DestinationQueueName;
namespaceManager.CreateQueue(sourceQueueDescription);</pre>
<div class="preview">
<pre class="csharp">QueueDescription&nbsp;sourceQueueDescription&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;QueueDescription(SourceQueueName);&nbsp;
sourceQueueDescription.ForwardTo&nbsp;=&nbsp;DestinationQueueName;&nbsp;
namespaceManager.CreateQueue(sourceQueueDescription);</pre>
</div>
</div>
</div>
<div>
<div>To forward messages from a deadletter queue, set the QueueDescription.ForwardDeadLetteredMessagesTo property to the path of destination queue or topic. Again, Service Bus requires the sender to attach a token that indicates that the sender has send permissions
 on the source topic. The sender does not need any permissions on the destination queue.
<div>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">QueueDescription sourceQueueDescription = new QueueDescription(SourceQueueName); 
sourceQueueDescription.ForwardDeadLetteredMessagesTo = DestinationQueue.Path; 
namespaceManager.CreateQueue(sourceQueueDescription);</pre>
<div class="preview">
<pre class="csharp">QueueDescription&nbsp;sourceQueueDescription&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;QueueDescription(SourceQueueName);&nbsp;&nbsp;
sourceQueueDescription.ForwardDeadLetteredMessagesTo&nbsp;=&nbsp;DestinationQueue.Path;&nbsp;&nbsp;
namespaceManager.CreateQueue(sourceQueueDescription);</pre>
</div>
</div>
</div>
<div>
<div>Sending a message to a destination queue or topic via a transfer queue can be used to send multiple messages to different queues/topics in a single transaction. Service Bus does not support to directly send multiple messages to different queues in a single
 transaction. To achieve this, set up a transfer queue and send all messages via that transfer queue. The transaction spans the sending into the transfer queue. From there, Service Bus automatically pumps each of the messages into&nbsp;their destination queues.
 To send messages to a destination queue via a transfer queue, the sender must have permissions to send to both queues. This can be achieved by giving the sender namespace-level send permission or use the same key and key name for the send rule for both entities.
<div>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">namespaceManager.CreateQueue(DestinationQueueName);
namespaceManager.CreateQueue(TransferQueueName);
MessageSender sender = messagingFactory.CreateMessageSender(DestinationQueueName, TransferQueueName);
sender.Send(new BrokeredMessage(&quot;my message&quot;));</pre>
<div class="preview">
<pre class="csharp">namespaceManager.CreateQueue(DestinationQueueName);&nbsp;
namespaceManager.CreateQueue(TransferQueueName);&nbsp;
MessageSender&nbsp;sender&nbsp;=&nbsp;messagingFactory.CreateMessageSender(DestinationQueueName,&nbsp;TransferQueueName);&nbsp;
sender.Send(<span class="cs__keyword">new</span>&nbsp;BrokeredMessage(<span class="cs__string">&quot;my&nbsp;message&quot;</span>));</pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
</div>
</div>
<h1>More Information</h1>
For more information on Autoforwarding, see <a href="http://msdn.microsoft.com/en-us/library/windowsazure/jj687471.aspx">
Chaining Service Bus Entities with Auto-forwarding</a>.</div>
</div>
</div>
</div>
</div>
</div>

</div>


    </div>
</body>
</html>
